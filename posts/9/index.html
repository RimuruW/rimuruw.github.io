<!DOCTYPE html>
<html lang="zh-cn">
    <head><meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1'><meta name='description' content='无需配置 Hexo 环境~ 在任何可以打开网页的设备上即可编辑你的 Hexo 博客并部署！
 你要先清楚某些东西…  在私有仓库下使用 GitHub Action 是不完全免费的。 对于免费用户，你每个月只能使用 GitHub Action 工作 2000 min。这个数据计算方法特别有意思，详见 GitHub   据我多次测试，对于我的博客，GitHub Action 每次部署大概要耗时 1 min。 假设你每次提交需要耗时 2 min，这意味着你如果使用私有仓库存放后续操作中的源码，你每个月只能提交 1000 次博客。折算下来，也就是说，你每天只能提交 33 次博客。
需要特别说明的，上面的时间计算是在 Linux 环境下的计算。如果你在后续操作中使用的 Operating system 是 Windows 或 macOS ，则 GitHub Action 记录的时间分别是你实际使用时间的 2 倍和 10 倍。
话说，如果你能做到每天提交 33 次博客，请务必留个联系方式让我认识一下。没别的意思，就是想瞻仰一下劳模的风采。
  在测试过程中，我发现即使使用 Linux 作为 Operating system， GitHub Action 实际工作时间也和 GitHub 计费时间并不相同。 同时，我在 GitHub Action 界面发现如下文字：  This is the workflow execution time which may be different than the billed time.'><title>GitHub Action 实现 Hexo 博客持续集成</title>

<link rel='canonical' href='https://blog.linioi.com/posts/9/'>

<link rel="stylesheet" href="/scss/style.min.css"><meta property='og:title' content='GitHub Action 实现 Hexo 博客持续集成'>
<meta property='og:description' content='无需配置 Hexo 环境~ 在任何可以打开网页的设备上即可编辑你的 Hexo 博客并部署！
 你要先清楚某些东西…  在私有仓库下使用 GitHub Action 是不完全免费的。 对于免费用户，你每个月只能使用 GitHub Action 工作 2000 min。这个数据计算方法特别有意思，详见 GitHub   据我多次测试，对于我的博客，GitHub Action 每次部署大概要耗时 1 min。 假设你每次提交需要耗时 2 min，这意味着你如果使用私有仓库存放后续操作中的源码，你每个月只能提交 1000 次博客。折算下来，也就是说，你每天只能提交 33 次博客。
需要特别说明的，上面的时间计算是在 Linux 环境下的计算。如果你在后续操作中使用的 Operating system 是 Windows 或 macOS ，则 GitHub Action 记录的时间分别是你实际使用时间的 2 倍和 10 倍。
话说，如果你能做到每天提交 33 次博客，请务必留个联系方式让我认识一下。没别的意思，就是想瞻仰一下劳模的风采。
  在测试过程中，我发现即使使用 Linux 作为 Operating system， GitHub Action 实际工作时间也和 GitHub 计费时间并不相同。 同时，我在 GitHub Action 界面发现如下文字：  This is the workflow execution time which may be different than the billed time.'>
<meta property='og:url' content='https://blog.linioi.com/posts/9/'>
<meta property='og:site_name' content='清絮的博客'>
<meta property='og:type' content='article'><meta property='article:section' content='Post' /><meta property='article:tag' content='GitHub Action' /><meta property='article:tag' content='Hexo' /><meta property='article:published_time' content='2020-04-29T01:47:09&#43;00:00'/><meta property='article:modified_time' content='2020-04-29T01:47:09&#43;00:00'/><meta property='og:image' content='https://blog.linioi.com/src/opengraph.jpg' />
<meta name="twitter:site" content="@QingxuMo">
    <meta name="twitter:creator" content="@QingxuMo"><meta name="twitter:title" content="GitHub Action 实现 Hexo 博客持续集成">
<meta name="twitter:description" content="无需配置 Hexo 环境~ 在任何可以打开网页的设备上即可编辑你的 Hexo 博客并部署！
 你要先清楚某些东西…  在私有仓库下使用 GitHub Action 是不完全免费的。 对于免费用户，你每个月只能使用 GitHub Action 工作 2000 min。这个数据计算方法特别有意思，详见 GitHub   据我多次测试，对于我的博客，GitHub Action 每次部署大概要耗时 1 min。 假设你每次提交需要耗时 2 min，这意味着你如果使用私有仓库存放后续操作中的源码，你每个月只能提交 1000 次博客。折算下来，也就是说，你每天只能提交 33 次博客。
需要特别说明的，上面的时间计算是在 Linux 环境下的计算。如果你在后续操作中使用的 Operating system 是 Windows 或 macOS ，则 GitHub Action 记录的时间分别是你实际使用时间的 2 倍和 10 倍。
话说，如果你能做到每天提交 33 次博客，请务必留个联系方式让我认识一下。没别的意思，就是想瞻仰一下劳模的风采。
  在测试过程中，我发现即使使用 Linux 作为 Operating system， GitHub Action 实际工作时间也和 GitHub 计费时间并不相同。 同时，我在 GitHub Action 界面发现如下文字：  This is the workflow execution time which may be different than the billed time."><meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:image" content='https://blog.linioi.com/src/opengraph.jpg' />
    <link rel="shortcut icon" href="/favicon.ico" />
<style>
    :root {
        --article-font-family: "Noto Serif SC", var(--base-font-family);
    }
</style>
<script>  	(function () { const customFont = document.createElement('link'); customFont.href = "<https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@400;700&display=swap>"; customFont.type = "text/css"; customFont.rel = "stylesheet"; document.head.appendChild(customFont); }());
</script>
    </head>
    <body class="
    article-page has-toc
">
    <script>
        (function() {
            const colorSchemeKey = 'StackColorScheme';
            if(!localStorage.getItem(colorSchemeKey)){
                localStorage.setItem(colorSchemeKey, "auto");
            }
        })();
    </script><script>
    (function() {
        const colorSchemeKey = 'StackColorScheme';
        const colorSchemeItem = localStorage.getItem(colorSchemeKey);
        const supportDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches === true;

        if (colorSchemeItem == 'dark' || colorSchemeItem === 'auto' && supportDarkMode) {
            

            document.documentElement.dataset.scheme = 'dark';
        } else {
            document.documentElement.dataset.scheme = 'light';
        }
    })();
</script>
<div class="container main-container flex 
    
        extended
    
">
    
        <div id="article-toolbar">
            <a href="https://blog.linioi.com" class="back-home">
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-chevron-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <polyline points="15 6 9 12 15 18" />
</svg>



                <span>返回</span>
            </a>
        </div>
    
<main class="main full-width">
    <article class="main-article">
    <header class="article-header">

    <div class="article-details">
    
    <header class="article-category">
        
            <a href="/categories/others/" >
                Others
            </a>
        
    </header>
    

    <h2 class="article-title">
        <a href="/posts/9/">GitHub Action 实现 Hexo 博客持续集成</a>
    </h2>

    

    
    <footer class="article-time">
        
            <div>
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <path d="M11.795 21h-6.795a2 2 0 0 1 -2 -2v-12a2 2 0 0 1 2 -2h12a2 2 0 0 1 2 2v4" />
  <circle cx="18" cy="18" r="4" />
  <path d="M15 3v4" />
  <path d="M7 3v4" />
  <path d="M3 11h16" />
  <path d="M18 16.496v1.504l1 1" />
</svg>
                <time class="article-time--published">Apr 29, 2020</time>
            </div>
        

        
            <div>
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="12" r="9" />
  <polyline points="12 7 12 12 15 15" />
</svg>



                <time class="article-time--reading">
                    阅读时长: 5 分钟
                </time>
            </div>
        
    </footer>
    
</div>
</header>

    <section class="article-content">
    <blockquote>
<p>无需配置 Hexo 环境~
在任何可以打开网页的设备上即可编辑你的 Hexo 博客并部署！</p>
</blockquote>
<!-- raw HTML omitted -->
<h2 id="你要先清楚某些东西">你要先清楚某些东西…</h2>
<ul>
<li>在私有仓库下使用 GitHub Action 是<strong>不完全免费的</strong>。
对于免费用户，<strong>你每个月只能使用 GitHub Action 工作 2000 min</strong>。这个数据计算方法特别有意思，详见 <a class="link" href="https://help.github.com/en/github/setting-up-and-managing-billing-and-payments-on-github/about-billing-for-github-actions"  target="_blank" rel="noopener"
    >GitHub</a></li>
</ul>
<blockquote>
<p>据我多次测试，对于我的博客，GitHub Action 每次部署大概要耗时 1 min。
假设你每次提交需要耗时 2 min，这意味着你如果使用私有仓库存放后续操作中的源码，你每个月只能提交 1000 次博客。折算下来，也就是说，你每天只能提交 33 次博客。</p>
<p>需要特别说明的，上面的时间计算是在 Linux 环境下的计算。如果你在后续操作中使用的 Operating system 是 Windows 或 macOS ，则 GitHub Action 记录的时间分别是你实际使用时间的 2 倍和 10 倍。</p>
<p>话说，如果你能做到每天提交 33 次博客，请务必留个联系方式让我认识一下。没别的意思，就是想瞻仰一下劳模的风采。</p>
</blockquote>
<ul>
<li>在测试过程中，<strong>我发现即使使用 Linux 作为 Operating system，  GitHub Action 实际工作时间也和 GitHub 计费时间并不相同</strong>。
同时，我在 GitHub Action 界面发现如下文字：</li>
</ul>
<pre><code>This is the workflow execution time which may be different than the billed time.
</code></pre><ul>
<li>如果你需要自定义域名，你的<code>CNAME</code>文件应放在 Hexo 源码仓库的 source 文件夹下。</li>
<li><a class="link" href="mailto:hexo-action@v1.0.0" >hexo-action@v1.0.0</a> 会自动删除项目仓库下的<code>.deploy_git</code>文件。即每次提交源码后，部署 Hexo 的那个仓库的所有历史提交将会被清空。这个问题在 <a class="link" href="mailto:hexo-action@1.0.1" >hexo-action@1.0.1</a> 被修复。我认为这个修复是不合理的。</li>
<li>如果需要添加额外的 node module，则在<code>package.json</code>中添加相应依赖。</li>
</ul>
<h2 id="默认已满足的条件">默认已满足的条件</h2>
<ul>
<li>已注册 GitHub 账号</li>
<li>已有一个部署到 GitHub 且工作正常的 Hexo 博客</li>
<li>有一定动手能力</li>
</ul>
<hr>
<p>接下来，让我们开始……</p>
<h2 id="方法一">方法一</h2>
<hr>
<h3 id="部署集成环境">部署集成环境</h3>
<ol>
<li>GitHub 建立一个新的仓库，公有还是私有，取决于你的选择。建议此时生成 SSH 密匙简化后续提交过程。</li>
</ol>
<blockquote>
<p><strong>特别提醒，对于 GitHub 免费用户，私有仓库每个月的数据传输上限为 1GB</strong>。 &lt;===<em>该部分内容源自 GitHub 文档，但是实际操作中并未发现该现象，目前还在考证中</em>。
GitHub Actions 部署时使用的数据不会计入数据传输上限。</p>
</blockquote>
<ol start="2">
<li>在博客源码中新建<code>.github/workflows/hexo.yml</code>文件，在文件添加如下内容：</li>
</ol>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#f92672">name</span>: <span style="color:#ae81ff">Deploy</span> <span style="color:#75715e"># workflow 名字</span>

<span style="color:#f92672">on</span>:
  [<span style="color:#ae81ff">push]</span> <span style="color:#75715e"># 触发事件</span>

<span style="color:#f92672">jobs</span>:
  <span style="color:#f92672">build</span>: <span style="color:#75715e"># Job 1 ID</span>
    <span style="color:#f92672">runs-on</span>: <span style="color:#ae81ff">ubuntu-latest</span> <span style="color:#75715e"># 设定运行环境为最新版 Ubuntu，如果你有把握的话，你也可以改成其它运行环境。参见文末备注。</span>
    <span style="color:#f92672">name</span>: <span style="color:#ae81ff">Deploy blog.</span>
    <span style="color:#f92672">steps</span>:
    - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">Checkout</span> <span style="color:#75715e"># Step 1 获取源码</span>
      <span style="color:#f92672">uses</span>: <span style="color:#ae81ff">actions/checkout@v1</span> <span style="color:#75715e"># 使用 actions/checkout@v1</span>
      <span style="color:#f92672">with</span>: <span style="color:#75715e"># 条件</span>
        <span style="color:#f92672">submodules</span>: <span style="color:#66d9ef">true</span> <span style="color:#75715e">## Checkout private submodules(themes or something else).参见文末备注。</span>

    <span style="color:#75715e"># Caching dependencies to speed up workflows. (GitHub will remove any cache entries that have not been accessed in over 7 days.) 缓存压缩 node_modules，不用每次下载，使用时解压，可以加快工作流的执行过程，超过 7 天没有使用将删除压缩包。</span>
    - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">Cache node modules</span> <span style="color:#75715e"># Step 2</span>
      <span style="color:#f92672">uses</span>: <span style="color:#ae81ff">actions/cache@v1</span>
      <span style="color:#f92672">id</span>: <span style="color:#ae81ff">cache</span>
      <span style="color:#f92672">with</span>:
        <span style="color:#f92672">path</span>: <span style="color:#ae81ff">node_modules</span>
        <span style="color:#f92672">key</span>: <span style="color:#ae81ff">${{ runner.os }}-node-${{ hashFiles(&#39;**/package-lock.json&#39;) }}</span>
        <span style="color:#f92672">restore-keys</span>: |<span style="color:#e6db74">
</span><span style="color:#e6db74">          </span>          <span style="color:#ae81ff">${{ runner.os }}-node-</span>
    - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">Install Dependencies</span> <span style="color:#75715e"># Step 3 </span>
      <span style="color:#f92672">if</span>: <span style="color:#ae81ff">steps.cache.outputs.cache-hit != &#39;true&#39;</span> <span style="color:#75715e"># 如果变量 cache-hit 不等于 true</span>
      <span style="color:#f92672">run</span>: <span style="color:#ae81ff">npm install</span> <span style="color:#75715e"># 安装 NPM 相关依赖</span>

    <span style="color:#75715e"># Deploy hexo blog website.</span>
    - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">Deploy</span> <span style="color:#75715e"># Step 4</span>
      <span style="color:#f92672">id</span>: <span style="color:#ae81ff">deploy</span>
      <span style="color:#f92672">uses</span>: <span style="color:#ae81ff">sma11black/hexo-action@v1.0.1</span>
      <span style="color:#f92672">with</span>:
        <span style="color:#f92672">deploy_key</span>: <span style="color:#ae81ff">${{ secrets.DEPLOY_KEY }}</span>
        <span style="color:#f92672">user_name</span>: <span style="color:#ae81ff">your github name</span> <span style="color:#75715e">#你 GitHub 用户名。如果去除该行则使用 bot。去除该行是不推荐行为。</span>
        <span style="color:#f92672">user_email</span>: <span style="color:#ae81ff">yourgithubemail@example.com</span> <span style="color:#75715e">#你 GitHub 邮箱。如果去除该行则使用 bot。去除该行是不推荐行为。</span>
        <span style="color:#f92672">commit_msg</span>: <span style="color:#ae81ff">${{ github.event.head_commit.message }}</span> <span style="color:#75715e">#Hexo 部署博客的自动提交备注</span>
</code></pre></div><p><strong>部分内容需要根据你实际情况修改为相应内容</strong></p>
<ol start="3">
<li>push 你的博客源码到刚刚新建的仓库。</li>
</ol>
<blockquote>
<p>建议在 push 前进行一次 <code>hexo clean</code>。且在每一次<code>hexo g</code>后准备 push，都应该进行一次 <code>hexo clean</code></p>
</blockquote>
<ol start="4">
<li>输入如下命令再生成一对 SSH 密匙。</li>
</ol>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">ssh-keygen -t rsa -f ~/.ssh/id_rsa_a -C <span style="color:#e6db74">&#34;example@example.com&#34;</span>
</code></pre></div><p>如果你使用的是未预安装 OpenSSH 软件的 Linux 发行版，你需要先安装 OpenSSH 再进行如下步骤。
命令中的邮箱填自己 GitHub 的邮箱。此时会在本地生成一对公匙和私匙。</p>
<ol start="5">
<li>
<p>打开你 GitHub 存放源码的那个仓库，转到<code>Settings &gt; Secrets</code>，创建一个名为<code>DEPLOY_KEY</code>的<code>Secret</code>，复制上面生成的私匙内容。<strong>复制内容应该包含私匙开始的&mdash;&ndash;BEGIN OPENSSH PRIVATE KEY&mdash;&ndash; 和结束的 &mdash;&ndash;END OPENSSH PRIVATE KEY&mdash;&ndash;</strong></p>
</li>
<li>
<p>打开你部署博客的那个仓库，即仓库名为 yourgithubname.github.io 的那个仓库，转到<code>Settings &gt; Deploy Keys</code>，输入上面生成的公匙，勾选 “Allow write access”并确定。</p>
</li>
<li>
<p>享受你的 GitHub CI 吧~</p>
</li>
</ol>
<h3 id="备注内容可以不看">备注内容（可以不看）</h3>
<ul>
<li>其他可选的运行环境请参见 <a class="link" href="https://github.com/actions/virtual-environments/tree/ubuntu18/20200406.2"  target="_blank" rel="noopener"
    >GitHub</a></li>
<li>关于 Submodules 参见 <a class="link" href="https://github.com/sma11black/hexo-action#use-submodule-in-your-hexo-repository"  target="_blank" rel="noopener"
    >GitHub</a></li>
</ul>
<h2 id="方法二">方法二</h2>
<ol>
<li>
<p>打开 github.com</p>
</li>
<li>
<p>在 <code>Settings</code> - <code>Developer settings</code> - <code>Personal access tokens</code> - <code>Generate new token</code> 中创建密钥，勾选 Repo，拉到最下面，Generate token，接着将生成的 Token 保存下来（Token 只会出现一次，请务必妥善保管）</p>
</li>
<li>
<p>在你 Hexo 博客文件仓库/分支所在的仓库 的 Settings - Secrets - Add a new secret 创建俩个变量分别是 <code>GH_REF</code> 和 <code>GH_TOKEN</code>。
GH_REF 内容为你 GitHub Pages 仓库的地址（不需要包含 https）
GH_TOKEN 内容为上面所获取的 Token。</p>
</li>
</ol>
<p>如果你对自动部署细节不感兴趣，可以直接跳转 <a class="link" href="https://blog.linioi.com/posts/9/#%E6%88%90%E5%93%81"  target="_blank" rel="noopener"
    >成品</a> 复制并根据自己情况修改即可。</p>
<h3 id="配置内容">配置内容</h3>
<p>1.名称(这个随意取)</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#f92672">name</span>: <span style="color:#ae81ff">Hexo Blog Deploy</span>
</code></pre></div><p>2.指定触发 workflow 的事件，这里选择的是推送至指定分支的事件</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#f92672">on</span>:
  <span style="color:#f92672">push</span>: <span style="color:#75715e"># 这里是推送事件</span>
    <span style="color:#f92672">branches</span>:
      - <span style="color:#ae81ff">master</span> <span style="color:#75715e"># 这里指定了推送的分支</span>
</code></pre></div><p>3.设置时区，这里设置的是上海的</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#f92672">env</span>:
  <span style="color:#f92672">TZ</span>: <span style="color:#ae81ff">Asia/Shanghai</span>
</code></pre></div><p>4.指定 workflow 所运行的系统，此处设置的是最新 Ubuntu。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#f92672">blog-cicd</span>:
  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">Hexo build</span>
  <span style="color:#f92672">runs-on</span>: <span style="color:#ae81ff">ubuntu-latest</span>
</code></pre></div><p>5.检出代码，设置 Node 环境</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml">- <span style="color:#f92672">name</span>: <span style="color:#ae81ff">Checkout codes</span>
  <span style="color:#f92672">uses</span>: <span style="color:#ae81ff">actions/checkout@v2</span>

- <span style="color:#f92672">name</span>: <span style="color:#ae81ff">Setup node</span>
  <span style="color:#f92672">uses</span>: <span style="color:#ae81ff">actions/setup-node@v1.1.0</span>
  <span style="color:#f92672">with</span>:
    <span style="color:#f92672">node-version</span>: <span style="color:#e6db74">&#34;12.x&#34;</span> <span style="color:#75715e"># Node 的版本</span>
</code></pre></div><p>6.同步子模块。如果没有使用子模块的话，这一步可以忽略。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml">- <span style="color:#f92672">name</span>: <span style="color:#ae81ff">Checkout submodules</span>
  <span style="color:#f92672">run</span>: |<span style="color:#e6db74">
</span><span style="color:#e6db74">    auth_header=&#34;$(git config --local --get http.https://github.com/.extraheader)&#34;
</span><span style="color:#e6db74">    git submodule sync --recursive
</span><span style="color:#e6db74">    git -c &#34;http.extraheader=$auth_header&#34; -c protocol.version=2 submodule update --init --force --recursive --depth=1</span>    
</code></pre></div><p>7.缓存 .npm 目录，加快构建速度</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml">- <span style="color:#f92672">name</span>: <span style="color:#ae81ff">Cache Node Dependencies</span> <span style="color:#75715e"># Npm 缓存，这一步报错的话，把这部分删掉即可</span>
  <span style="color:#f92672">id</span>: <span style="color:#ae81ff">cache</span>
  <span style="color:#f92672">uses</span>: <span style="color:#ae81ff">actions/cache@v1</span>
  <span style="color:#f92672">with</span>:
    <span style="color:#f92672">path</span>: <span style="color:#ae81ff">.npm</span>
    <span style="color:#f92672">key</span>: <span style="color:#ae81ff">${{runner.OS}}-npm-caches-${{ hashFiles(&#39;package-lock.json&#39;) }}</span>
</code></pre></div><p>8.安装依赖。我建议，如果可以，请每次都执行以下步骤。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml">- <span style="color:#f92672">name</span>: <span style="color:#ae81ff">Install dependencies</span>
  <span style="color:#f92672">run</span>: |<span style="color:#e6db74">
</span><span style="color:#e6db74">    npm install hexo-cli -g
</span><span style="color:#e6db74">    npm install</span>    
</code></pre></div><p>9.生成文件。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml">- <span style="color:#f92672">name</span>: <span style="color:#ae81ff">Generate files</span>
  <span style="color:#f92672">run</span>: |<span style="color:#e6db74">
</span><span style="color:#e6db74">    </span>    <span style="color:#ae81ff">hexo clean &amp;&amp; hexo generate</span>
</code></pre></div><p>10.将 GitHub Pages 仓库克隆下来，并将 .git 目录移动到生成文件的文件夹文件夹中（这样可以保留之前的 commit 记录），然后再将其推送到 GitHub Pages</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml">- <span style="color:#f92672">name</span>: <span style="color:#ae81ff">Deploy blog</span>
  <span style="color:#f92672">run</span>: |<span style="color:#e6db74">
</span><span style="color:#e6db74">    git clone &#34;https://${{ secrets.GH_REF }}&#34; deploy_git
</span><span style="color:#e6db74">    mv ./deploy_git/.git ./public/
</span><span style="color:#e6db74">    cd ./public
</span><span style="color:#e6db74">    git config --local user.email &#34;your@email&#34; # 你的邮箱
</span><span style="color:#e6db74">    git config --local user.name &#34;yourname&#34; # 你的用户名
</span><span style="color:#e6db74">    git add .
</span><span style="color:#e6db74">    git commit -m &#34;GitHub Actions Auto Builder at $(date +&#39;%Y-%m-%d %H:%M:%S&#39;)&#34;
</span><span style="color:#e6db74">    git push --force &#34;https://${{ secrets.GH_TOKEN }}@${{ secrets.GH_REF }}&#34; master:master</span>    
</code></pre></div><h3 id="成品">成品</h3>
<p>最后的 workflow</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#f92672">name</span>: <span style="color:#ae81ff">Blog Deploy</span>

<span style="color:#f92672">on</span>:
  <span style="color:#f92672">push</span>:
    <span style="color:#f92672">branches</span>:
      - <span style="color:#ae81ff">master</span>

<span style="color:#f92672">env</span>:
  <span style="color:#f92672">TZ</span>: <span style="color:#ae81ff">Asia/Shanghai</span>

<span style="color:#f92672">jobs</span>:
  <span style="color:#f92672">blog-cicd</span>:
    <span style="color:#f92672">name</span>: <span style="color:#ae81ff">Hexo build and deploy</span>
    <span style="color:#f92672">runs-on</span>: <span style="color:#ae81ff">ubuntu-latest</span>

    <span style="color:#f92672">steps</span>:
      - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">Checkout codes</span>
        <span style="color:#f92672">uses</span>: <span style="color:#ae81ff">actions/checkout@v2</span>

      - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">Setup node</span>
        <span style="color:#f92672">uses</span>: <span style="color:#ae81ff">actions/setup-node@v1.1.0</span>
        <span style="color:#f92672">with</span>:
          <span style="color:#f92672">node-version</span>: <span style="color:#e6db74">&#34;12.x&#34;</span>

<span style="color:#75715e"># 若需要同步子模块的话，将下面的注释删掉即可</span>
<span style="color:#75715e">#</span>
<span style="color:#75715e">#      - name: Checkout submodules</span>
<span style="color:#75715e">#        run: |</span>
<span style="color:#75715e">#          auth_header=&#34;$(git config --local --get http.https://github.com/.extraheader)&#34;</span>
<span style="color:#75715e">#          git submodule sync --recursive</span>
<span style="color:#75715e">#          git -c &#34;http.extraheader=$auth_header&#34; -c protocol.version=2 submodule update --init --force --recursive --depth=1</span>

      - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">Cache Node Dependencies</span> <span style="color:#75715e"># Npm 缓存，这一步报错的话，把这部分删掉即可</span>
        <span style="color:#f92672">id</span>: <span style="color:#ae81ff">cache</span>
        <span style="color:#f92672">uses</span>: <span style="color:#ae81ff">actions/cache@v1</span>
        <span style="color:#f92672">with</span>:
          <span style="color:#f92672">path</span>: <span style="color:#ae81ff">.npm</span>
          <span style="color:#f92672">key</span>: <span style="color:#ae81ff">${{runner.OS}}-npm-caches-${{ hashFiles(&#39;package-lock.json&#39;) }}</span>

      - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">Install dependencies</span>
        <span style="color:#f92672">run</span>: |<span style="color:#e6db74">
</span><span style="color:#e6db74">          npm install hexo-cli -g
</span><span style="color:#e6db74">          npm install</span>          

      - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">Generate files</span>
        <span style="color:#f92672">run</span>: |<span style="color:#e6db74">
</span><span style="color:#e6db74">          </span>          <span style="color:#ae81ff">hexo clean &amp;&amp; hexo generate</span>

      - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">Deploy blog</span>
        <span style="color:#f92672">run</span>: |<span style="color:#e6db74">
</span><span style="color:#e6db74">          git clone &#34;https://${{ secrets.GH_REF }}&#34; deploy_git
</span><span style="color:#e6db74">          mv ./deploy_git/.git ./public/
</span><span style="color:#e6db74">          cd ./public
</span><span style="color:#e6db74">          git config --local user.email &#34;your@email&#34; # 你的邮箱
</span><span style="color:#e6db74">          git config --local user.name &#34;yourname&#34; # 你的用户名
</span><span style="color:#e6db74">          git add .
</span><span style="color:#e6db74">          git commit -m &#34;GitHub Actions Auto Builder at $(date +&#39;%Y-%m-%d %H:%M:%S&#39;)&#34;
</span><span style="color:#e6db74">          git push --force &#34;https://${{ secrets.GH_TOKEN }}@${{ secrets.GH_REF }}&#34; master:master</span>          
</code></pre></div><h2 id="我的配置文件">我的配置文件</h2>
<p>如果你还是无法理解的话，可以直接复制我的配置文件，然后修改用户名和邮箱为自己 GitHub 的用户名和邮箱。</p>
<blockquote>
<p>Note：请注意修改 Clone themes 中的主题链接为你所用的主题的 URL</p>
</blockquote>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#f92672">name</span>: <span style="color:#ae81ff">GitHub Auto Buider For Blog</span>

<span style="color:#f92672">on</span>:
  <span style="color:#f92672">push</span>:
    <span style="color:#f92672">branches</span>:
      - <span style="color:#ae81ff">master</span>
  <span style="color:#f92672">schedule</span>:
    - <span style="color:#f92672">cron</span>: <span style="color:#e6db74">&#39;0 21 * * *&#39;</span>

<span style="color:#f92672">env</span>:
  <span style="color:#f92672">TZ</span>: <span style="color:#ae81ff">Asia/Shanghai</span>

<span style="color:#f92672">jobs</span>:
  <span style="color:#f92672">blog-cicd</span>:
    <span style="color:#f92672">name</span>: <span style="color:#ae81ff">Hexo build and deploy</span>
    <span style="color:#f92672">runs-on</span>: <span style="color:#ae81ff">ubuntu-latest</span>

    <span style="color:#f92672">steps</span>:
      - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">Checkout codes</span>
        <span style="color:#f92672">uses</span>: <span style="color:#ae81ff">actions/checkout@v2</span>

      - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">Setup node</span>
        <span style="color:#f92672">uses</span>: <span style="color:#ae81ff">actions/setup-node@v1.1.0</span>
        <span style="color:#f92672">with</span>:
          <span style="color:#f92672">node-version</span>: <span style="color:#e6db74">&#34;12.x&#34;</span>

      - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">Clone themes</span>
        <span style="color:#f92672">run</span>: |<span style="color:#e6db74">
</span><span style="color:#e6db74">          </span>          <span style="color:#ae81ff">git clone -b dev https://github.com/YunYouJun/hexo-theme-yun.git themes/yun</span>

      - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">Cache Node Dependencies</span>
        <span style="color:#f92672">id</span>: <span style="color:#ae81ff">cache</span>
        <span style="color:#f92672">uses</span>: <span style="color:#ae81ff">actions/cache@v1</span>
        <span style="color:#f92672">with</span>:
          <span style="color:#f92672">path</span>: <span style="color:#ae81ff">.npm</span>
          <span style="color:#f92672">key</span>: <span style="color:#ae81ff">${{runner.OS}}-npm-caches-${{ hashFiles(&#39;package-lock.json&#39;) }}</span>

      - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">Install dependencies</span>
        <span style="color:#f92672">run</span>: |<span style="color:#e6db74">
</span><span style="color:#e6db74">          npm install hexo-cli -g
</span><span style="color:#e6db74">          npm install
</span><span style="color:#e6db74">          npm audit fix</span>          

      - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">Generate files</span>
        <span style="color:#f92672">run</span>: |<span style="color:#e6db74">
</span><span style="color:#e6db74">          </span>          <span style="color:#ae81ff">hexo clean &amp;&amp; hexo generate</span>

      - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">Deploy blog</span>
        <span style="color:#f92672">run</span>: |<span style="color:#e6db74">
</span><span style="color:#e6db74">          git clone &#34;https://${{ secrets.GH_REF }}&#34; deploy_git
</span><span style="color:#e6db74">          mv ./deploy_git/.git ./public/
</span><span style="color:#e6db74">          cd ./public
</span><span style="color:#e6db74">          git config --local user.email &#34;xxxx&#34; # 你的邮箱
</span><span style="color:#e6db74">          git config --local user.name &#34;RimuruW&#34; # 你的用户名
</span><span style="color:#e6db74">          git add .
</span><span style="color:#e6db74">          git commit -m &#34;GitHub Actions Auto Builder at $(date +&#39;%Y-%m-%d %H:%M:%S&#39;)&#34;
</span><span style="color:#e6db74">          git push --force &#34;https://${{ secrets.GH_TOKEN }}@${{ secrets.GH_REF }}&#34; master:master</span>          
</code></pre></div><p>参考文档：</p>
<ul>
<li><a class="link" href="https://github.com/sma11black/hexo-action"  target="_blank" rel="noopener"
    >Hexo-Action</a></li>
<li><a class="link" href="https://isteed.cc/posts/hexo-github-action/"  target="_blank" rel="noopener"
    >Lufs&rsquo;s blog</a></li>
</ul>

</section>


    <footer class="article-footer">
    
    <section class="article-tags">
        
            <a href="/tags/github-action/">GitHub Action</a>
        
            <a href="/tags/hexo/">Hexo</a>
        
    </section>


    
    <section class="article-copyright">
        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="12" r="9" />
  <path d="M14.5 9a3.5 4 0 1 0 0 6" />
</svg>



        <span>Licensed under CC BY-NC-SA 4.0</span>
    </section>
    </footer>


    
</article>

    <aside class="related-contents--wrapper">
    
    
        <h2 class="section-title">相关文章</h2>
        <div class="related-contents">
            <div class="flex article-list--tile">
                
                    
<article class="">
    <a href="/posts/deploy-blog-to-cf/">
        
        

        <div class="article-details">
            <h2 class="article-title">利用 Cloudflare Workers Site 部署静态博客</h2>
        </div>
    </a>
</article>
                
                    
<article class="">
    <a href="/posts/change-to-new-domain/">
        
        

        <div class="article-details">
            <h2 class="article-title">博客域名迁移</h2>
        </div>
    </a>
</article>
                
                    
<article class="has-image">
    <a href="/posts/3/">
        
        
            <div class="article-image">
                <img src="/posts/3/cover.27ce992381b08e5c6a5f984413b2bf45_hu33c5f08c98762c53a78672665d2839cf_25837_250x150_fill_q75_box_smart1.jpg" 
                        width="250" 
                        height="150" 
                        loading="lazy" 
                        data-key="3" 
                        data-hash="md5-J86ZI4GwjlxqX5hEE7K/RQ==">
                
            </div>
        

        <div class="article-details">
            <h2 class="article-title">浅谈手机通知推送</h2>
        </div>
    </a>
</article>
                
                    
<article class="">
    <a href="/posts/13/">
        
        

        <div class="article-details">
            <h2 class="article-title">欧盟或将仿造中国建网络防火墙</h2>
        </div>
    </a>
</article>
                
                    
<article class="">
    <a href="/posts/7/">
        
        

        <div class="article-details">
            <h2 class="article-title">First Blog</h2>
        </div>
    </a>
</article>
                
            </div>
        </div>
    
</aside>

     
     
        
    <script src='//cdn.jsdelivr.net/npm/@waline/client/dist/Waline.min.js'></script>
<div id="waline" class="waline-container"></div>
<style>
    .waline-container {
        background-color: var(--card-background);
        border-radius: var(--card-border-radius);
        box-shadow: var(--shadow-l1);
        padding: var(--card-padding);
    }
    .waline-container .vcount {
        color: var(--card-text-color-main);
    }
</style><script>
    
    new Waline({"avatar":"mp","dark":"html[data-scheme=\"dark\"]","el":"#waline","emoji":["https://cdn.jsdelivr.net/gh/walinejs/emojis@1.0.0/weibo","https://cdn.jsdelivr.net/gh/walinejs/emojis@1.0.0/bilibili","https://cdn.jsdelivr.net/gh/walinejs/emojis@1.0.0/alus","https://cdn.jsdelivr.net/gh/walinejs/emojis@1.0.0/qq","https://cdn.jsdelivr.net/gh/walinejs/emojis@1.0.0/tieba","https://cdn.jsdelivr.net/gh/walinejs/emojis@1.0.0/tw-emoji"],"highlight":true,"locale":{"admin":"博主"},"mathtagsupport":true,"requiredMeta":["mail"],"serverURL":"https://waline.linioi.com","visitor":true});
</script>

    

    <footer class="site-footer">
    <section class="copyright">
        &copy; 
        
            2020 - 
        
        2021 清絮的博客
    </section>
    
    <section class="powerby">
        Built with <a href="https://gohugo.io/" target="_blank" rel="noopener">Hugo</a> <br />
        Theme <b><a href="https://github.com/CaiJimmy/hugo-theme-stack" target="_blank" rel="noopener" data-version="3.1.0">Stack</a></b> designed by <a href="https://jimmycai.com" target="_blank" rel="noopener">Jimmy</a>
    </section>
</footer>


    
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    
    <div class="pswp__bg"></div>

    
    <div class="pswp__scroll-wrap">

        
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                
                
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                        <div class="pswp__preloader__cut">
                            <div class="pswp__preloader__donut"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div>
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js"integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo="crossorigin="anonymous"
                defer="true"
                >
            </script><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js"integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU="crossorigin="anonymous"
                defer="true"
                >
            </script><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.css"integrity="sha256-c0uckgykQ9v5k&#43;IqViZOZKc47Jn7KQil4/MP3ySA3F8="crossorigin="anonymous"
            ><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.css"integrity="sha256-SBLU4vv6CA6lHsZ1XyTdhyjJxCjPif/TRkjnsyGAGnE="crossorigin="anonymous"
            >

            </main>
    
        <aside class="sidebar right-sidebar sticky">
            <section class="widget archives">
                <div class="widget-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <line x1="5" y1="9" x2="19" y2="9" />
  <line x1="5" y1="15" x2="19" y2="15" />
  <line x1="11" y1="4" x2="7" y2="20" />
  <line x1="17" y1="4" x2="13" y2="20" />
</svg>



                </div>
                <h2 class="widget-title section-title">目录</h2>
                
                <div class="widget--toc">
                    <nav id="TableOfContents">
  <ol>
    <li><a href="#你要先清楚某些东西">你要先清楚某些东西…</a></li>
    <li><a href="#默认已满足的条件">默认已满足的条件</a></li>
    <li><a href="#方法一">方法一</a>
      <ol>
        <li><a href="#部署集成环境">部署集成环境</a></li>
        <li><a href="#备注内容可以不看">备注内容（可以不看）</a></li>
      </ol>
    </li>
    <li><a href="#方法二">方法二</a>
      <ol>
        <li><a href="#配置内容">配置内容</a></li>
        <li><a href="#成品">成品</a></li>
      </ol>
    </li>
    <li><a href="#我的配置文件">我的配置文件</a></li>
  </ol>
</nav>
                </div>
            </section>
        </aside>
    

        </div>
        <script 
                src="https://cdn.jsdelivr.net/npm/node-vibrant@3.1.5/dist/vibrant.min.js"integrity="sha256-5NovOZc4iwiAWTYIFiIM7DxKUXKWvpVEuMEPLzcm5/g="crossorigin="anonymous"
                defer="false"
                >
            </script><script type="text/javascript" src="/ts/main.js" defer></script>
<script>
    (function () {
        const customFont = document.createElement('link');
        customFont.href = "https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap";

        customFont.type = "text/css";
        customFont.rel = "stylesheet";

        document.head.appendChild(customFont);
    }());
</script>

    </body>
</html>
